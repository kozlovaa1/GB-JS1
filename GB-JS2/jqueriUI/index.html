<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ДЗ 6. jQuery UI</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
          integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <!--<link rel="stylesheet" href="style.css">-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script
            src="http://code.jquery.com/ui/1.12.1/jquery-ui.js"
            integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body>
<div class="container">
    <div>
        <h2>Форма с валидацией</h2>
        <div class="form-group">
            <label for="userName">Имя пользователя</label>
            <input type="text" class="form-control" id="userName">
            <div class="invalid-feedback"></div>
            <label for="userPhone">Телефон</label>
            <input type="phone" class="form-control" id="userPhone" placeholder="+7(000)000-0000">
            <div class="invalid-feedback"></div>
            <label for="userEmail">Email</label>
            <input type="email" class="form-control" id="userEmail" placeholder="mymail@mail.ru">
            <div class="invalid-feedback"></div>
            <label for="userBirthDate">Дата рождения</label>
            <input type="text" class="form-control" id="userBirthDate" placeholder="дд.мм.гггг">
            <div class="invalid-feedback"></div>
            <label for="text">Текст</label>
            <textarea name="text" class="form-control" id="text"></textarea>
        </div>
        <button class="btn btn-primary" id="sendForm">Отправить</button>
    </div>
</div>
<script>
    /*1) На сайте в форме обратной связи добавьте следующие поля:
        a) поле даты рождения;
        b) ошибочные поля подсветить с помощью какого-нибудь эффекта, например, Bounce.*/

    $("#userBirthDate").datepicker({
        monthNames: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь"
            , "Ноябрь", "Декабрь"],
        dayNamesMin: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"],
        firstDay: 1,
        dateFormat: "dd.mm.yy",
        changeYear: true,
        yearRange: "-100:+00"
    });

    /*2) Все возвращаемые ошибки выводить с помощью виджета Dialog.*/
    $('.invalid-feedback').dialog({
        buttons: [
            {
                text: "OK",
                click: function() {
                    $( this ).dialog( "close" );
                }
            }
        ]
    });
    /*3) Создать карусель популярных товаров в шапке.*/

    /*4) * C помощью jQuery UI добавить возможность перемещать товар прямо в корзину мышью.*/


    /*Обработка формы из 2 урока*/
    const userName = document.querySelector('#userName'); //Поле Имя
    const userPhone = document.querySelector('#userPhone'); //Поле Телефон
    const userEmail = document.querySelector('#userEmail'); // Поле Email
    const submitForm = document.querySelector('#sendForm'); // Кнопка отправки формы
    const inputFields = document.querySelector('.form-control');

    /**
     * Проверка полей формы
     */
    function validateForm() {
        let pcre; //Сюда записываем регулярное выражение для проверки
        let error = ''; //Текст ошибки

        /**
         * Вывод ошибки
         */
        function writeValidateError(error, block) {
            block.nextElementSibling.innerHTML = error;
            block.className += ' is-invalid';
        }

        // Проверяем Имя
        pcre = /^[A-Za-z\u0430-\u044F\u0410-\u042F\s]+$/;
        if (!pcre.test(userName.value)) {
            error = 'Имя может содержать только буквы и пробелы';
            writeValidateError(error, userName);
        }

        //Проверяем телефон
        pcre = /^\+[0-9]\([0-9]{3}\)[0-9]{3}-[0-9]{4}$/;
        if (!pcre.test(userPhone.value)) {
            error = 'Телефон должен быть формата +7(000)000-0000';
            writeValidateError(error, userPhone);
        }

        //Проверяем email
        pcre = /^[A-Za-z0-9\u0430-\u044F\u0410-\u042F.-]+@([A-Za-z0-9\u0430-\u044F\u0410-\u042F]{1,2}|[A-Za-z0-9\u0430-\u044F\u0410-\u042F]((?!(\.\.))[A-Za-z0-9\u0430-\u044F\u0410-\u042F.-])+[A-Za-z0-9\u0430-\u044F\u0410-\u042F])\.[A-Za-z\u0430-\u044F\u0410-\u042F]{2,}$/;
        if (!pcre.test(userEmail.value)) {
            error = 'Неправильный формат email';
            writeValidateError(error, userEmail);
        }
    }

    submitForm.addEventListener('click', validateForm); // Запуск проверки по нажатию кнопки Отправить
    inputFields.addEventListener('click', function () {
        document.querySelector('.invalid-feedback').innerHTML = ''; // Очищаем все тексты предыдущих ошибок
    });
</script>
</body>
</html>